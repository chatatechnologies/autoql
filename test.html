<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <script src="src/d3.v4.js"></script>
    <script src="src/d3.tip.js"></script>
    <title></title>
    <style media="screen">
        .domain{
            stroke: #d3d3d352;
        }
        .tick{
            stroke: #d3d3d352;
            fill-opacity: 0.7;
        }
        line{
            stroke-width: 1px;
            stroke: currentColor;
            opacity: 0.15;
            shape-rendering: crispedges;
        }
        text{
            font-family: "Titillium Web", sans-serif;
            letter-spacing: 0.04em;
            fill: #5d5d5d;
        }

        .d3-tip {
            line-height: 1;
            letter-spacing: 0.04em;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 2px;
            font-family: "Titillium Web", sans-serif;
            font-size: 13px;
            color: #ececec;
        }
        .title-tip{
            font-weight: bold;
            color: #fff;

        }

        /* Creates a small triangle extender for the tooltip */
        .d3-tip:after {
            box-sizing: border-box;
            display: inline;
            font-size: 10px;
            width: 100%;
            line-height: 1;
            color: rgba(0, 0, 0, 0.8);
            content: "\25BC";
            position: absolute;
            text-align: center;
        }

        /* Style northward tooltips differently */
        .d3-tip.n:after {
            margin: -1px 0 0 0;
            top: 100%;
            left: 0;
        }

        @-webkit-keyframes bounceIn {
            0% {
                opacity: 0;
                -webkit-transform: scale(.3);
            }
            50% {
                opacity: 1;
                -webkit-transform: scale(1.05);
            }
            70% {
                -webkit-transform: scale(.9);
            }
            100% {
                -webkit-transform: scale(1);
            }
        }
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(.9);
            }
            100% {
                transform: scale(1);
            }
        }
        .d3-tip.animate {
            animation: bounceIn 0.2s ease-out;
            -webkit-animation: bounceIn 0.2s ease-out;
        }

        .grid line {stroke: currentColor; stroke-opacity: 1;shape-rendering: crispEdges;}
        .grid path {stroke-width: 0;}

    </style>
</head>
<body>
    <div id="foo" data-containerid="1"></div>
    <script>
    var data = [
        {
            "categorie": "Student",
            "values": [
                {
                    "value": 0,
                    "rate": "Not at all"
                },
                {
                    "value": 4,
                    "rate": "Not very much"
                },
                {
                    "value": 12,
                    "rate": "Medium"
                },
                {
                    "value": 6,
                    "rate": "Very much"
                },
                {
                    "value": 0,
                    "rate": "Tremendously"
                }
            ]
        },
        {
            "categorie": "Liberal Profession",
            "values": [
                {
                    "value": 1,
                    "rate": "Not at all"
                },
                {
                    "value": 21,
                    "rate": "Not very much"
                },
                {
                    "value": 13,
                    "rate": "Medium"
                },
                {
                    "value": 18,
                    "rate": "Very much"
                },
                {
                    "value": 6,
                    "rate": "Tremendously"
                }
            ]
        },
        {
            "categorie": "Salaried Staff",
            "values": [
            {
                "value": 3,
                "rate": "Not at all"
            },
            {
                "value": 22,
                "rate": "Not very much"
            },
            {
                "value": 6,
                "rate": "Medium"
            },
            {
                "value": 15,
                "rate": "Very much"
            },
            {
                "value": 3,
                "rate": "Tremendously"
            }
            ]
        },
        {
            "categorie": "Employee",
            "values": [
            {
                "value": 12,
                "rate": "Not at all"
            },
            {
                "value": 7,
                "rate": "Not very much"
            },
            {
                "value": 18,
                "rate": "Medium"
            },
            {
                "value": 13,
                "rate": "Very much"
            },
            {
                "value": 6,
                "rate": "Tremendously"
            }
            ]
        },
        {
            "categorie": "Craftsman",
            "values": [
            {
                "value": 6,
                "rate": "Not at all"
            },
            {
                "value": 15,
                "rate": "Not very much"
            },
            {
                "value": 9,
                "rate": "Medium"
            },
            {
                "value": 12,
                "rate": "Very much"
            },
            {
                "value": 3,
                "rate": "Tremendously"
            }
            ]
        },
        {
            "categorie": "Inactive",
            "values": [
            {
                "value": 6,
                "rate": "Not at all"
            },
            {
                "value": 6,
                "rate": "Not very much"
            },
            {
                "value": 6,
                "rate": "Medium"
            },
            {
                "value": 2,
                "rate": "Very much"
            },
            {
                "value": 3,
                "rate": "Tremendously"
            }
            ]
        }
        ]
    var margin = {top: 20, right: 20, bottom: 30, left: 120},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

    var y0 = d3.scaleBand()
    .rangeRound([0, height]).padding(.1);

    var y1 = d3.scaleBand();

    var x = d3.scaleLinear()
    .range([0, width]).nice();

    var xAxis = d3.axisBottom(x)
    .tickSize(0)

    var yAxis = d3.axisLeft(y0)

    var color = d3.scaleOrdinal()
    .range(["#ca0020","#f4a582","#d5d5d5","#92c5de","#0571b0"]);

    var svg = d3.select('body').append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


    var categoriesNames = data.map(function(d) { return d.categorie; });
    var rateNames = data[0].values.map(function(d) { return d.rate; });

    y0.domain(categoriesNames);
    y1.domain(rateNames).rangeRound([0, y0.bandwidth()]).padding(.1);
    x.domain([0, d3.max(data, function(categorie) { return d3.max(categorie.values, function(d) { return d.value; }); })]);

    svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + (height) + ")")
    .call(xAxis);

    svg.append("g")
    .attr("class", "y axis")
    .style('opacity','1')
    .call(yAxis)
    // .append("text")
    // .attr("transform", "rotate(-90)")
    // .attr("y", 6)
    // .attr("dy", ".71em")
    // .style("text-anchor", "end")
    // .style('font-weight','bold')
    // .text("Value");

    // svg.select('.y').transition().duration(500).delay(1300).style('opacity','1');

    var slice = svg.selectAll(".slice")
    .data(data)
    .enter().append("g")
    .attr("class", "g")
    .attr("transform",function(d) { return "translate(0,"+ y0(d.categorie) +")"; });

    slice.selectAll("rect")
    .data(function(d) { return d.values; })
    .enter().append("rect")
    .attr("width", function(d) { return Math.abs(x(d.value) - x(0)); })
    .attr("x", function(d) { return x(Math.min(0, d.value)); })
    .attr("y", function(d) { return y1(d.rate); })
    .attr("height", function(d) { return y1.bandwidth() })
    .style("fill", function(d) { return color(d.rate) })
    .on("mouseover", function(d) {
        d3.select(this).style("fill", d3.rgb(color(d.rate)).darker(2));
    })
    .on("mouseout", function(d) {
        d3.select(this).style("fill", color(d.rate));
    });

    // slice.selectAll("rect")
    // .transition()
    // .delay(function (d) {return Math.random()*1000;})
    // .duration(1000)
    // .attr("y", function(d) { return y(d.value); })
    // .attr("height", function(d) { return height - y(d.value); });

    //Legend
    var legend = svg.selectAll(".legend")
    .data(data[0].values.map(function(d) { return d.rate; }).reverse())
    .enter().append("g")
    .attr("class", "legend")
    .attr("transform", function(d,i) { return "translate(0," + i * 20 + ")"; })
    .style("opacity","1");

    legend.append("rect")
    .attr("x", width - 18)
    .attr("width", 18)
    .attr("height", 18)
    .style("fill", function(d) { return color(d); });

    legend.append("text")
    .attr("x", width - 24)
    .attr("y", 9)
    .attr("dy", ".35em")
    .style("text-anchor", "end")
    .text(function(d) {return d; });


    </script>
</body>
</html>
