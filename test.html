<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <!-- <script src="src/d3.v4.js"></script> -->
    <!-- <script src="src/d3.tip.js"></script> -->
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <title></title>
    <style media="screen">
        .domain{
            stroke: #d3d3d352;
        }
        .tick{
            stroke: #d3d3d352;
            fill-opacity: 0.7;
        }
        line{
            stroke-width: 1px;
            stroke: currentColor;
            opacity: 0.15;
            shape-rendering: crispedges;
        }
        text{
            font-family: "Titillium Web", sans-serif;
            letter-spacing: 0.04em;
            fill: #5d5d5d;
        }

        .d3-tip {
            line-height: 1;
            letter-spacing: 0.04em;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 2px;
            font-family: "Titillium Web", sans-serif;
            font-size: 13px;
            color: #ececec;
        }
        .title-tip{
            font-weight: bold;
            color: #fff;

        }

        /* Creates a small triangle extender for the tooltip */
        .d3-tip:after {
            box-sizing: border-box;
            display: inline;
            font-size: 10px;
            width: 100%;
            line-height: 1;
            color: rgba(0, 0, 0, 0.8);
            content: "\25BC";
            position: absolute;
            text-align: center;
        }

        /* Style northward tooltips differently */
        .d3-tip.n:after {
            margin: -1px 0 0 0;
            top: 100%;
            left: 0;
        }

        @-webkit-keyframes bounceIn {
            0% {
                opacity: 0;
                -webkit-transform: scale(.3);
            }
            50% {
                opacity: 1;
                -webkit-transform: scale(1.05);
            }
            70% {
                -webkit-transform: scale(.9);
            }
            100% {
                -webkit-transform: scale(1);
            }
        }
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(.9);
            }
            100% {
                transform: scale(1);
            }
        }
        .d3-tip.animate {
            animation: bounceIn 0.2s ease-out;
            -webkit-animation: bounceIn 0.2s ease-out;
        }

        .grid line {stroke: currentColor; stroke-opacity: 1;shape-rendering: crispEdges;}
        .grid path {stroke-width: 0;}

    </style>
    <link href="https://unpkg.com/tabulator-tables@4.6.3/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.6.3/dist/js/tabulator.min.js"></script>
</head>
<body>

    <div data-componentid="tabulator" class="autoql-vanilla-chata-table" style="max-width:55%">

    </div>

    <div id="foo" data-containerid="1"></div>
    <script>

    function get_colors(n) {
        var colors = ["#a6cee3","#1f78b4","#b2df8a","#33a02c",
        "#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6",
        "#6a3d9a"];

        return colors[ n % colors.length];}

        var margin = {top: 61, right: 140, bottom: 101, left: 50},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

        var  times = ["12am","1a", "2a", "3a", "4a", "5a", "6a",
        "7a", "8a", "9a", "10a", "11a", "12pm", "1p",
        "2p", "3p", "4p", "5p", "6p", "7p", "8p",
        "9p", "10p", "11p"];

        var x = d3.scale.linear()
        .range([0, width]);

        var y = d3.scale.linear()
        .range([height, 0]);

        var color = d3.scale.category10();

        var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom")
        .ticks(24, "s");

        var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .ticks(5, "s");

        var area = d3.svg.area()
        .x(function(d) { return x(d.hour); })
        .y0(function(d) { return y(d.y0); })
        .y1(function(d) { return y(d.y0 + d.y); });


        var stack = d3.layout.stack()
        .values(function(d) { return d.values; });

        var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append("text")
        .attr("x", 0)
        .attr("y", -40)
        .attr("dy", "0.71em")
        .attr("fill", "#000")
        .text("SFPD Incidents by Hour in Dec 2016")
        .style("font", "23px avenir")
        .style("fill", "#000000");


        svg.append("text")
        .attr("x", 0)
        .attr("y", 402)
        .attr("dy", "0em")
        .style("font", "12px avenir")
        .style("fill", "#000000")
        .text("This is a plot of the 10 most frequent incidents over a 24-hour period  in San Francisco during December 2016. Interestingly enough, most ");

        svg.append("text")
        .attr("x", 0)
        .attr("y", 402)
        .attr("dy", "1em")
        .style("font", "12px avenir")
        .style("fill", "#000000")
        .text("categories follow a similar structure: the occurences dip in the early morning and peak during the lunch and early evening hours.");

        svg.append("text")
        .attr("x", 0)
        .attr("y", 402)
        .attr("dy", "3em")
        .style("font", "12px avenir")
        .style("fill", "#000000")
        .text("By Anaelia Ovalle")
        .style("font-weight", "bold");



        d3.csv("data.csv", function(error, data) {

            color.domain(d3.keys(data[0]).filter(function(key) {return key !== "hour"; }));

            data.forEach(function(d) {
                d.hour = +d.hour;
                d.burglary = +d.burglary;
                d.assault= +d.assault;
                d.larceny_theft= +d.larceny_theft;
                d.vehicle_related = +d.vehicle_related;
                d.missing_person = +d.missing_person;
                d.non_criminal = +d.non_criminal;
                d.other_offenses = +d.other_offenses;
                d.suspicious_occ = +d.suspicious_occ;
                d.warrants = +d.warrants;
            });



            var browsers = stack(color.domain().map(function(name) {
                return {
                    name: name,
                    values: data.map(function(d) {
                        return {hour: d.hour, y: d[name] * 1};
                    })
                };
            }));


            //   // Find the value of the hour with highest total value
            var maxHourVal = d3.max(data, function(d){
                var vals = d3.keys(d).map(
                function(key){
                    return key !== "hour" ? d[key] : 0 });
                    return d3.sum(vals);
                });

                //   // Set domains for axes
                x.domain(d3.extent(data, function(d) { return d.hour; }));
                y.domain([0, 800])

                var browser = svg.selectAll(".browser")
                .data(browsers)
                .enter().append("g")
                .attr("class", "browser");

                browser.append("path")
                .attr("class", "area")
                .attr("d", function(d) { return area(d.values); })
                .style("fill", function(d,i) {
                    return get_colors(i); });


                    browser.append("text")
                    .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
                    .attr("transform", function(d) { return "translate(" + x(d.value.hour) + "," + y(d.value.y0 + d.value.y / 2) + ")"; })
                    .attr("x", -6)
                    .attr("dy", "-0.882em")
                    .text(function(d) {
                        if(d.name == "larceny_theft"){
                            return "larceny/theft";
                        }
                        if(d.name == "non_criminal"){
                            return "non-criminal";
                        }
                        if(d.name == "assault"){
                            return d.name;
                        }})
                        .style("font", "15px avenir")
                        .attr("transform", function(d) { return "translate(500," + y(d.value.y0 + d.value.y / 2) + ")"; })

                        svg.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis).append("text")
                        .attr("x", 350)
                        .attr("y", 36)
                        .attr("fill", "#000")
                        .text("Hour of Time")
                        .style("font-weight", "bold");

                        svg.append("g")
                        .attr("class", "y axis")
                        .call(yAxis)
                        .append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("x", -250)
                        .attr("y", -40)
                        .attr("dy", "0.3408em")
                        .attr("fill", "#000")
                        .text("Number of Incidents")
                        .style("font-weight", "bold");

                        var legend = svg.selectAll(".legend")
                        .data(color.domain()).enter()
                        .append("g")
                        .attr("class","legend")
                        .attr("transform", "translate(" + (width +20) + "," + 0+ ")");

                        legend.append("rect")
                        .attr("x", 0)
                        .attr("y", function(d, i) { return 20 * i; })
                        .attr("width", 10)
                        .attr("height", 10)
                        .style("fill", function(d, i) {
                            return get_colors(i);});

                            legend.append("text")
                            .attr("x", 20)
                            .attr("dy", "0.75em")
                            .attr("y", function(d, i) { return 20 * i; })
                            .text(function(d) {return d});

                            legend.append("text")
                            .attr("x",0)
                            //      .attr("dy", "0.75em")
                            .attr("y",-10)
                            .text("Categories");


                        });


    // // set the dimensions and margins of the graph
    // var margin = {top: 10, right: 30, bottom: 30, left: 60},
    // width = 460 - margin.left - margin.right,
    // height = 400 - margin.top - margin.bottom;
    //
    // // append the svg object to the body of the page
    // var svg = d3.select("#foo")
    // .append("svg")
    // .attr("width", width + margin.left + margin.right)
    // .attr("height", height + margin.top + margin.bottom)
    // .append("g")
    // .attr("transform",
    // "translate(" + margin.left + "," + margin.top + ")");
    //
    // //Read the data
    // d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/5_OneCatSevNumOrdered.csv", function(data) {
    //
    //     // group the data: one array for each value of the X axis.
    //     console.log(data);
    //     var sumstat = d3.nest()
    //     .key(function(d) { return d.year;})
    //     .entries(data);
    //
    //     // Stack the data: each group will be represented on top of each other
    //     var mygroups = ["Helen", "Amanda", "Ashley"] // list of group names
    //     var mygroup = [1,2,3] // list of group names
    //     var stackedData = d3.stack()
    //     .keys(mygroup)
    //     .value(function(d, key){
    //         return d.values[key].n
    //     })
    //     (sumstat)
    //     console.log(sumstat);
    //     console.log(stackedData);
    //
    //     // Add X axis --> it is a date format
    //     var x = d3.scaleLinear()
    //     .domain(d3.extent(data, function(d) { return d.year; }))
    //     .range([ 0, width ]);
    //     svg.append("g")
    //     .attr("transform", "translate(0," + height + ")")
    //     .call(d3.axisBottom(x).ticks(5));
    //
    //     // Add Y axis
    //     var y = d3.scaleLinear()
    //     .domain([0, d3.max(data, function(d) { return +d.n; })*1.2])
    //     .range([ height, 0 ]);
    //     svg.append("g")
    //     .call(d3.axisLeft(y));
    //
    //     // color palette
    //     var color = d3.scaleOrdinal()
    //     .domain(mygroups)
    //     .range(['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf','#999999'])
    //
    //     // Show the areas
    //     svg
    //     .selectAll("mylayers")
    //     .data(stackedData)
    //     .enter()
    //     .append("path")
    //     .style("fill", function(d) { name = mygroups[d.key-1] ;  return color(name); })
    //     .attr("d", d3.area()
    //     .x(function(d, i) { return x(d.data.key); })
    //     .y0(function(d) { return y(d[0]); })
    //     .y1(function(d) { return y(d[1]); })
    //     )
    //
    // })
    // var data = [
    //     {
    //         "label": "Student",
    //         "values": [
    //             {
    //                 "value": 2,
    //                 "group": "Not at all"
    //             },
    //             {
    //                 "value": 4,
    //                 "group": "Not very much"
    //             },
    //             {
    //                 "value": 12,
    //                 "group": "Medium"
    //             },
    //             {
    //                 "value": 6,
    //                 "group": "Very much"
    //             },
    //             {
    //                 "value": 3,
    //                 "group": "Tremendously"
    //             }
    //         ]
    //     },
    //     {
    //         "label": "Liberal Profession",
    //         "values": [
    //             {
    //                 "value": 1,
    //                 "group": "Not at all"
    //             },
    //             {
    //                 "value": 21,
    //                 "group": "Not very much"
    //             },
    //             {
    //                 "value": 13,
    //                 "group": "Medium"
    //             },
    //             {
    //                 "value": 18,
    //                 "group": "Very much"
    //             },
    //             {
    //                 "value": 6,
    //                 "group": "Tremendously"
    //             }
    //         ]
    //     },
    //     {
    //         "label": "Salaried Staff",
    //         "values": [
    //         {
    //             "value": 3,
    //             "group": "Not at all"
    //         },
    //         {
    //             "value": 22,
    //             "group": "Not very much"
    //         },
    //         {
    //             "value": 6,
    //             "group": "Medium"
    //         },
    //         {
    //             "value": 15,
    //             "group": "Very much"
    //         },
    //         {
    //             "value": 3,
    //             "group": "Tremendously"
    //         }
    //         ]
    //     },
    //     {
    //         "label": "Employee",
    //         "values": [
    //         {
    //             "value": 12,
    //             "group": "Not at all"
    //         },
    //         {
    //             "value": 7,
    //             "group": "Not very much"
    //         },
    //         {
    //             "value": 18,
    //             "group": "Medium"
    //         },
    //         {
    //             "value": 13,
    //             "group": "Very much"
    //         },
    //         {
    //             "value": 6,
    //             "group": "Tremendously"
    //         }
    //         ]
    //     },
    //     {
    //         "label": "Craftsman",
    //         "values": [
    //         {
    //             "value": 6,
    //             "group": "Not at all"
    //         },
    //         {
    //             "value": 15,
    //             "group": "Not very much"
    //         },
    //         {
    //             "value": 9,
    //             "group": "Medium"
    //         },
    //         {
    //             "value": 12,
    //             "group": "Very much"
    //         },
    //         {
    //             "value": 3,
    //             "group": "Tremendously"
    //         }
    //         ]
    //     },
    //     {
    //         "label": "Inactive",
    //         "values": [
    //         {
    //             "value": 6,
    //             "group": "Not at all"
    //         },
    //         {
    //             "value": 6,
    //             "group": "Not very much"
    //         },
    //         {
    //             "value": 6,
    //             "group": "Medium"
    //         },
    //         {
    //             "value": 2,
    //             "group": "Very much"
    //         },
    //         {
    //             "value": 3,
    //             "group": "Tremendously"
    //         }
    //         ]
    //     }
    //     ]
    //
    //     var margin = {top: 10, right: 100, bottom: 30, left: 30},
    //     width = 760 - margin.left - margin.right,
    //     height = 400 - margin.top - margin.bottom;
    //
    //     // append the svg object to the body of the page
    //     var svg = d3.select("#foo")
    //     .append("svg")
    //     .attr("width", width + margin.left + margin.right)
    //     .attr("height", height + margin.top + margin.bottom)
    //     .append("g")
    //     .attr("transform",
    //     "translate(" + margin.left + "," + margin.top + ")");
    //
    //     const groupBy = (items, key) => items.reduce(
    //         (result, item) => ({
    //             ...result,
    //             [item[key]]: [
    //                 ...(result[item[key]] || []),
    //                 item,
    //             ],
    //         }),
    //         {},
    //     );
    //
    //     // List of groups (here I have one group per column)
    //     var labelsNames = data.map(function(d) { return d.label; });
    //     var allGroup = data[0].values.map(function(d) { return d.group; });
    //     var allData = []
    //     data.map(function(d) {
    //         d.values.map(function(v){
    //             v.label = d.label
    //             allData.push(v)
    //         })
    //     })
    //     var grouped = groupBy(allData, 'group');
    //     var dataReady = allGroup.map( function(grpName) { // .map allows to do something for each element of the list
    //         return {
    //             name: grpName,
    //             values: grouped[grpName]
    //         };
    //     });
    //     // I strongly advise to have a look to dataReady with
    //     // console.log(dataReady)
    //
    //     // A color scale: one color for each group
    //     var myColor = d3.scaleOrdinal()
    //     .domain(allGroup)
    //     .range(['#355C7D', '#6C5B7B', '#C06C84', '#f67280', '#F8B195']);
    //
    //     // Add X axis --> it is a date format
    //     var x = d3.scaleBand()
    //     .domain(labelsNames)
    //     .range([ 0, width ]);
    //     svg.append("g")
    //     .attr("transform", "translate(0," + height + ")")
    //     .call(d3.axisBottom(x))
    //     .selectAll("text")
    //     .style("color", '#fff')
    //     .style("text-anchor", "center")
    //
    //     const xShift = x.bandwidth() / 2
    //     console.log(xShift);
    //     // Add Y axis
    //     var y = d3.scaleLinear()
    //     .domain( [0,40])
    //     .range([ height, 0 ]);
    //     svg.append("g")
    //     .call(d3.axisLeft(y));
    //
    //     // Add the lines
    //     var line = d3.line()
    //     .x(function(d) { console.log(x(d.label)); return x(d.label) + xShift })
    //     .y(function(d) { return y(d.value) })
    //     svg.selectAll("myLines")
    //     .data(dataReady)
    //     .enter()
    //     .append("path")
    //     .attr("d", function(d){ return line(d.values) } )
    //     .attr("stroke", function(d){ return myColor(d.name) })
    //     .style("stroke-width", 4)
    //     .style("fill", "none")
    //
    //     // Add the points
    //     svg
    //     // First we need to enter in a group
    //     .selectAll("myDots")
    //     .data(dataReady)
    //     .enter()
    //     .append('g')
    //     .style("fill", function(d){ return myColor(d.name) })
    //     // Second we need to enter in the 'values' part of this group
    //     .selectAll("myPoints")
    //     .data(function(d){ return d.values })
    //     .enter()
    //     .append("circle")
    //     .attr("cx", function(d) { return x(d.label) + xShift } )
    //     .attr("cy", function(d) { return y(d.value) } )
    //     .attr("r", 5)
    //     .attr("stroke", "white")



    // var margin = {top: 20, right: 20, bottom: 30, left: 120},
    // width = 960 - margin.left - margin.right,
    // height = 500 - margin.top - margin.bottom;
    //
    // var y0 = d3.scaleBand()
    // .rangeRound([0, height]).padding(.1);
    //
    // var y1 = d3.scaleBand();
    //
    // var x = d3.scaleLinear()
    // .range([0, width]).nice();
    //
    // var xAxis = d3.axisBottom(x)
    // .tickSize(0)
    //
    // var yAxis = d3.axisLeft(y0)
    //
    // var color = d3.scaleOrdinal()
    // .range(["#ca0020","#f4a582","#d5d5d5","#92c5de","#0571b0"]);
    //
    // var svg = d3.select('body').append("svg")
    // .attr("width", width + margin.left + margin.right)
    // .attr("height", height + margin.top + margin.bottom)
    // .append("g")
    // .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    //
    //
    // var labelsNames = data.map(function(d) { return d.label; });
    // var groupNames = data[0].values.map(function(d) { return d.group; });
    //
    // y0.domain(labelsNames);
    // y1.domain(groupNames).rangeRound([0, y0.bandwidth()]).padding(.1);
    // x.domain([0, d3.max(data, function(label) { return d3.max(label.values, function(d) { return d.value; }); })]);
    //
    // svg.append("g")
    // .attr("class", "x axis")
    // .attr("transform", "translate(0," + (height) + ")")
    // .call(xAxis);
    //
    // svg.append("g")
    // .attr("class", "y axis")
    // .style('opacity','1')
    // .call(yAxis)
    // // .append("text")
    // // .attr("transform", "rotate(-90)")
    // // .attr("y", 6)
    // // .attr("dy", ".71em")
    // // .style("text-anchor", "end")
    // // .style('font-weight','bold')
    // // .text("Value");
    //
    // // svg.select('.y').transition().duration(500).delay(1300).style('opacity','1');
    //
    // var slice = svg.selectAll(".slice")
    // .data(data)
    // .enter().append("g")
    // .attr("class", "g")
    // .attr("transform",function(d) { return "translate(0,"+ y0(d.label) +")"; });
    //
    // slice.selectAll("rect")
    // .data(function(d) { return d.values; })
    // .enter().append("rect")
    // .attr("width", function(d) { return Math.abs(x(d.value) - x(0)); })
    // .attr("x", function(d) { return x(Math.min(0, d.value)); })
    // .attr("y", function(d) { return y1(d.group); })
    // .attr("height", function(d) { return y1.bandwidth() })
    // .style("fill", function(d) { return color(d.group) })
    // .on("mouseover", function(d) {
    //     d3.select(this).style("fill", d3.rgb(color(d.group)).darker(2));
    // })
    // .on("mouseout", function(d) {
    //     d3.select(this).style("fill", color(d.group));
    // });
    //
    // // slice.selectAll("rect")
    // // .transition()
    // // .delay(function (d) {return Math.random()*1000;})
    // // .duration(1000)
    // // .attr("y", function(d) { return y(d.value); })
    // // .attr("height", function(d) { return height - y(d.value); });
    //
    // //Legend
    // var legend = svg.selectAll(".legend")
    // .data(data[0].values.map(function(d) { return d.group; }).reverse())
    // .enter().append("g")
    // .attr("class", "legend")
    // .attr("transform", function(d,i) { return "translate(0," + i * 20 + ")"; })
    // .style("opacity","1");
    //
    // legend.append("rect")
    // .attr("x", width - 18)
    // .attr("width", 18)
    // .attr("height", 18)
    // .style("fill", function(d) { return color(d); });
    //
    // legend.append("text")
    // .attr("x", width - 24)
    // .attr("y", 9)
    // .attr("dy", ".35em")
    // .style("text-anchor", "end")
    // .text(function(d) {return d; });
    //

    </script>
</body>
</html>
